<?php
// Include your database connection file
include 'connect.php';

// Start the session at the beginning of the script
session_start();

/**
 * Function to handle user logout.
 */
function handleLogout() {
    // Unset all session variables and destroy the session
    $_SESSION = array();
    session_destroy();
    header("Location: index.php"); // Redirect to login page
    exit();
}

// Handle logout when the form is submitted
if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_POST['logout'])) {
    handleLogout();
}
?>



<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="./expenses.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>

<body>
    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="div" style="    flex-basis: 80%;
            display: flex;
            flex-direction: column;
            gap: 35px;">

                <div class="profile">
                    <img src="pp.jpg" alt="Profile Picture">
                    <h2><?php 
if (isset($_SESSION['email'])) {
    $email = $_SESSION['email'];
    $query = mysqli_query($conn, "SELECT users.* FROM `users` WHERE users.email='$email'");
    
    // Check if the query executed successfully
    if ($query) {
        while ($row = mysqli_fetch_array($query)) {
            echo $row['name'];
        }
    } else {
        echo "Error in query execution: " . mysqli_error($conn);
    }
}
?>
                    </h2>
                </div>
                <div class="menus">
                    <ul class="menu">
                        <li>
                            <a href="./homepage.php">
                                <!--?xml version="1.0" encoding="UTF-8"?-->
                                <svg id="Activity" width="18px" height="18px" viewBox="0 0 24 24" version="1.1"
                                    xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                    <title>Iconly/Light/Activity</title>
                                    <g id="Iconly/Light/Activity" stroke="none" stroke-width="1.5" fill="none"
                                        fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round">
                                        <g id="Activity" transform="translate(2.000000, 1.500000)" stroke="#000000"
                                            stroke-width="1.5">
                                            <polyline id="Path_33966"
                                                points="5.24485128 13.2814646 8.23798631 9.39130439 11.652174 12.0732266 14.5812358 8.29290622">
                                            </polyline>
                                            <circle id="Ellipse_741" cx="17.9954234" cy="2.70022885" r="1.92219681">
                                            </circle>
                                            <path
                                                d="M12.9244852,1.62013731 L5.6567506,1.62013731 C2.64530894,1.62013731 0.778032041,3.75286043 0.778032041,6.76430209 L0.778032041,14.846682 C0.778032041,17.8581237 2.60869567,19.9816935 5.6567506,19.9816935 L14.2608696,19.9816935 C17.2723113,19.9816935 19.1395882,17.8581237 19.1395882,14.846682 L19.1395882,7.80778036"
                                                id="Path"></path>
                                        </g>
                                    </g>
                                </svg>Dashboard</a></li>
                        <li><a href="task.php"><img width="20" height="20"
                                    src="https://img.icons8.com/material-outlined/18/student-center.png"
                                    alt="student-center" />Courses</a></li>
                        <li><a href="expenses.html"><img width="20" height="20" src="https://img.icons8.com/ios-glyphs/20/task.png"
                                    alt="task" />Expenses</a></li>
                        <li><a href="#"><img width="20" height="20"
                                    src="https://img.icons8.com/material-outlined/18/compass.png"
                                    alt="compass" />Schedules</a></li>
                        <li><a href="#"><img width="20" height="20"
                                    src="https://img.icons8.com/fluency-systems-regular/20/user-group-woman-woman.png"
                                    alt="user-group-woman-woman" />Classmates</a></li>
                        <li><a href="#"><img width="20" height="20" src="https://img.icons8.com/ios/20/settings.png"
                                    alt="settings" />Settings</a></li>
                    </ul>
                </div>
            </div>


            <form method="post" action="">
                <button type="submit" name="logout" class="logout"><img width="20" height="20"
                        src="https://img.icons8.com/windows/20/exit.png" alt="exit" / style="margin-right: 10px;">Log
                    Out</button>
            </form>
        </nav>
        <!-- Main Content -->
        <div class="main-content">
            <div class="middle">
                <div class="expenses-container">
                    <!-- Header Section -->
                    <div class="header">
                        <h1>Expenses</h1>
                        <p>01 - 25 March, 2020</p>
                      
                    </div>

                    <div class="chart-container">
                        <canvas id="lineChart"></canvas>
                    </div>
            
                    <!-- Bar Chart Section -->
                    <!-- <div class="bar-chart">
                        <div class="bar" style="height: 40%;"></div>
                        <div class="bar" style="height: 50%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 40%;"></div>
                        <div class="bar" style="height: 50%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 40%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 50%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;background-color: #66baff;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 40%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 70%;"></div>
                        <div class="bar" style="height: 60%;"></div>
                        <div class="bar" style="height: 80%;"></div>
                        <div class="bar" style="height: 40%;"></div>
                        <div class="bar" style="height: 30%;"></div> -->
                        <!-- Add more bars as needed -->
                    <!-- </div> -->
            
                    <!-- Expense List Section -->
                    <div class="expenses-list">
                        <div class="expense-card">
                            <p class="date">Today</p>
                            <div class="expense-item">
                                <div class="icon" style="background-color: #4A90E2;">&#128717;</div>
                                <div class="details">
                                    <p class="category">Grocery</p>
                                    <p class="time">5:12 pm &bull; Belanja di pasar</p>
                                </div>
                                <p class="amount negative">-326.800</p>
                            </div>
                            <div class="expense-item">
                                <div class="icon" style="background-color: #A633D6;">&#128652;</div>
                                <div class="details">
                                    <p class="category">Transportation</p>
                                    <p class="time">5:12 pm &bull; Naik bus umum</p>
                                </div>
                                <p class="amount negative">-15.000</p>
                            </div>
                            <div class="expense-item">
                                <div class="icon" style="background-color: #F5A623;">&#127968;</div>
                                <div class="details">
                                    <p class="category">Housing</p>
                                    <p class="time">5:12 pm &bull; Bayar Listrik</p>
                                </div>
                                <p class="amount negative">-185.750</p>
                            </div>
                        
                            <p class="date">Monday, 23 March 2020</p>
                            <div class="expense-item">
                                <div class="icon" style="background-color: #FF4A4A;">&#128142;</div>
                                <div class="details">
                                    <p class="category">Food and Drink</p>
                                    <p class="time">5:12 pm &bull; Makan Steak</p>
                                </div>
                                <p class="amount negative">-156.000</p>
                            </div>
                            <div class="expense-item">
                                <div class="icon" style="background-color: #50C878;">&#127918;</div>
                                <div class="details">
                                    <p class="category">Entertainment</p>
                                    <p class="time">5:12 pm &bull; Nonton Bioskop</p>
                                </div>
                                <p class="amount negative">-35.200</p>
                            </div>
                        </div>
                    </div>    
                </div>
            </div>

            <!----------Expenses panel------>
            <div class="side-panel">
                <!-- Expense Categories Section -->
                <div class="category-section">
                    <h2>Where your money go?</h2>
                        <div class="catgoryList">
                     <div class="category">
                        <div class="category-info">
                            <p>Food and Drinks</p>
                            <span>872.400</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 60%;"></div>
                        </div>
                    </div>
                    <div class="category">
                        <div class="category-info">
                            <p>Shopping</p>
                            <span>1.378.200</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 80%;"></div>
                        </div>
                    </div>
                    <div class="category">
                        <div class="category-info">
                            <p>Housing</p>
                            <span>928.500</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 70%;"></div>
                        </div>
                    </div>
                    <div class="category">
                        <div class="category-info">
                            <p>Transportation</p>
                            <span>420.700</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 50%;"></div>
                        </div>
                    </div>
                    <div class="category">
                        <div class="category-info">
                            <p>Vehicle</p>
                            <span>520.000</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress" style="width: 40%;"></div>
                        </div>
                    </div>
                    </div>


                </div>
        
                <!-- Save More Money Section -->
                <div class="save-more">
                    <div class="icon-boxes">
                        <div class="icon-box"></div>
                        <div class="icon-plant"></div>
                    </div>
                    <h3>Save more money</h3>
                    <p>eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim.</p>
                    <button>VIEW TIPS</button>
                </div>
            </div>
        </div>
    </div>

    <script src="./task.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="script.js"></script>
<script>
    // script.js

const ctx = document.getElementById('lineChart').getContext('2d');

new Chart(ctx, {
    type: 'line',
    data: {
        labels: [
            'Feb 1', 'Feb 7', 'Feb 15', 'Feb 22', 'Mar 1', 'Mar 8', 'Mar 15', 'Mar 22', 'Apr 1', 'Apr 8', 'Apr 15',
        ],
        datasets: [{
            label: 'Price',
            data: [150, 120, 200, 45, 145, 100, 145, 45, 200, 120, 150],
            borderColor: '#111',
            fill: false,
            tension: 0.4, // Smoothing effect
        }]
    },
    options: {
        respo:true,
        maintainAspectRatio: false,
        scales: {
            y: {
                beginAtZero: true,
                min: 0,
                max: 250,
                title: {
                    display: false,
                    text: 'Price',
                },
            },
            x: {
                title: {
                    display: false,
                    text: 'Date',
                },
            }
        },
        plugins: {
            legend: {
                display: false
            },
            annotation: {
                annotations: {
                    box1: {
                        type: 'box',
                        xMin: 8, // Start of shaded area (e.g., 'Apr 1')
                        xMax: 11, // End of shaded area (e.g., 'Apr 22')
                        backgroundColor: 'rgba(200, 200, 200, 0.2)',
                    }
                }
            }
        }
    }
});

</script>
</body>

</html>